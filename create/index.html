<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="author" content="Jacob Strieb" />
    <meta name="description" content="Password protect links using AES in the browser." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

    <link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">

    <title>Link Lock - Password-protect links</title>

    <link rel="stylesheet" href="../style.css" type="text/css" />

    <script type="text/javascript" src="../b64.js"></script>
    <script type="text/javascript" src="../api.js"></script>
    <script type="text/javascript">
        function error(text) {
            document.querySelector(".error").style.display = "inherit";
            document.querySelector("#errortext").innerText = `Error: ${text}`;
        }

        let isAuthenticated = false; // Flag to track authentication status

        function checkPassword() {
            const enteredPassword = document.getElementById("accessPassword").value;
            //  Replace 'yourSecretPassword' with your actual secret password or a more secure method.
            const storedPassword = localStorage.getItem('accessPassword');
            if(storedPassword === null){
                localStorage.setItem('accessPassword', 'USAM_DHS_Data_Security_System_Risks#010102?');
            }

            if (enteredPassword === localStorage.getItem('accessPassword')) {
                isAuthenticated = true;
                document.getElementById("password-protection").style.display = "none";
                document.getElementById("content").style.display = "block";
                main(); // Call main() to initialize the page content
            } else {
                error("Incorrect password.");
            }
        }

        // Run when the <body> loads
        function main() {
            // Fail if the b64 library or API was not loaded
            if (!("b64" in window)) {
                error("Base64 library not loaded.");
                return;
            }
            if (!("apiVersions" in window)) {
                error("API library not loaded.");
                return;
            }
        }
    </script>
    <script type="text/javascript" src="create.js"></script>
</head>

<body onload="checkPassword()">

    <div id="password-protection">
        <h1>Password Required</h1>
        <div class="form">
            <div class="labeled-input">
                <label for="accessPassword">Password:</label>
                <input type="password" id="accessPassword" />
            </div>
            <button onclick="checkPassword()">Submit</button>
            <div class="error red-border" style="display: none">
                <p id="errortext">Error</p>
            </div>
        </div>
    </div>

    <div id="content" style="display: none;">

        <noscript>
            <div style="border: 3px solid red; padding: 2em;">
                <p>If you are seeing this, it means that you have JavaScript disabled. As a result, the application will not work properly for you. For example, none of the buttons will work.</p>
            </div>
        </noscript>

        <div class="error red-border" style="display: none">
            <p id="errortext">Error</p>
            <button onclick="main()">Try again</button>
        </div>

        <h1>Link Lock</h1>
        <div>
            <p>This part of the website is dedicated to create securised link which ask password.
                <p style="color: red;">Only USAM DHS Management and higher may access to this page.</p>
            </p>
        </div>

        <hr />

        <div class="form">
            </div>

        <hr />

        <div class="output">
            </div>
    </div>
</body>

</html>
